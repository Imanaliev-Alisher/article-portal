# Портал статей

ASP.NET Core MVC приложение для управления статьями с поддержкой пользователей, категорий и загрузкой медиа файлов.

## Функционал

### ✅ Реализованные функции

1. **Аутентификация пользователей**
   - Регистрация новых пользователей
   - Вход в систему
   - Выход из системы
   - Защита страниц с помощью `[Authorize]`

2. **CRUD для статей**
   - Создание статей (только для авторизованных пользователей)
   - Просмотр списка всех статей
   - Просмотр детальной информации о статье
   - Редактирование статей (только автор)
   - Удаление статей (только автор)

3. **CRUD для категорий**
   - Создание категорий (только для авторизованных пользователей)
   - Просмотр списка категорий
   - Редактирование категорий (только для авторизованных пользователей)
   - Удаление категорий (только для авторизованных пользователей)

4. **Поиск и фильтрация**
   - Поиск статей по заголовку и содержанию
   - Фильтрация статей по категориям

5. **Загрузка медиа файлов**
   - Загрузка изображений при создании статьи
   - Замена изображений при редактировании
   - Автоматическое удаление старых изображений
   - Хранение изображений в `wwwroot/uploads`

6. **Панель администратора** (для Admin и Editor)
   - Статистика портала (количество статей, категорий, пользователей)
   - Управление всеми статьями (просмотр, редактирование, удаление)
   - Управление категориями (создание, редактирование, удаление)
   - Просмотр списка пользователей (только для Admin)
   - Поиск по статьям

## Технологии

- ASP.NET Core 8.0 MVC
- Entity Framework Core 8.0
- PostgreSQL (Npgsql)
- ASP.NET Core Identity (для аутентификации)
- Bootstrap 5 (для UI)

## Структура проекта

```
Portal/
├── Controllers/
│   ├── AccountController.cs      # Регистрация, логин, логаут
│   ├── ArticlesController.cs     # CRUD для статей + поиск + загрузка файлов
│   ├── CategoriesController.cs   # CRUD для категорий
│   └── HomeController.cs
├── Data/
│   └── PortalContext.cs          # Контекст БД с Identity
├── Models/
│   ├── ApplicationUser.cs        # Модель пользователя (Identity)
│   ├── Article.cs                # Модель статьи
│   ├── Category.cs               # Модель категории
│   ├── AccountViewModels.cs      # ViewModel для логина/регистрации
│   └── ErrorViewModel.cs
├── Views/
│   ├── Account/                  # Представления для аутентификации
│   ├── Articles/                 # Представления для статей
│   ├── Categories/               # Представления для категорий
│   └── Shared/
│       └── _Layout.cshtml        # Общий шаблон с навигацией
└── wwwroot/
    └── uploads/                  # Директория для загруженных изображений
```

## Настройка и запуск

### Требования

- .NET 8.0 SDK
- PostgreSQL

### Установка

1. Клонируйте репозиторий или откройте проект

2. Настройте строку подключения к PostgreSQL в `appsettings.json`:
```json
{
  "ConnectionStrings": {
    "DefaultConnection": "Host=localhost;Port=5432;Database=portaldb;Username=ваш_пользователь;Password=ваш_пароль"
  }
}
```

3. Восстановите пакеты:
```bash
dotnet restore
```

4. Создайте базу данных с помощью миграций Entity Framework Core:
```bash
# Установите EF Core tools (если еще не установлены)
dotnet tool install --global dotnet-ef

# Создайте базу данных
dotnet ef database update
```

5. (Опционально) Создайте тестовые данные:
```bash
dotnet run --seed
```

Это создаст:
- 3 тестовых пользователя (admin@portal.com, author@portal.com, writer@portal.com) с паролем для каждого
- 6 категорий (Технологии, Наука, Образование, Программирование, ИИ, Веб-разработка)
- 10 статей с разнообразным содержанием

**Тестовые учетные записи:**
- Email: `admin@portal.com` | Пароль: `Admin123!` | Роль: **Admin** (полный доступ)
- Email: `editor@portal.com` | Пароль: `Editor123!` | Роль: **Editor** (доступ к админ-панели)
- Email: `user@portal.com` | Пароль: `User123!` | Роль: **User** (обычный пользователь)

6. Запустите приложение:
```bash
dotnet run
```

База данных будет автоматически обновлена при каждом запуске благодаря `db.Database.Migrate()` в `Program.cs`.

### Работа с миграциями

Если вы изменили модели данных, создайте новую миграцию:
```bash
# Создать миграцию
dotnet ef migrations add <НазваниеМиграции>

# Применить миграцию к базе данных
dotnet ef database update

# Откатить последнюю миграцию
dotnet ef migrations remove

# Удалить базу данных (ВНИМАНИЕ: все данные будут потеряны)
dotnet ef database drop
```

5. Откройте браузер и перейдите по адресу: `https://localhost:5001` или `http://localhost:5000`

## Использование

### Первые шаги

1. **Регистрация**: Перейдите на страницу регистрации и создайте аккаунт
2. **Создание категории**: После входа создайте несколько категорий
3. **Создание статьи**: Создайте статью, выбрав категорию и загрузив изображение
4. **Поиск**: Используйте поле поиска для поиска статей
5. **Фильтрация**: Используйте выпадающий список для фильтрации по категориям

### Права доступа

- **Гости** (неавторизованные пользователи):
  - Просмотр списка статей
  - Просмотр деталей статьи
  - Просмотр категорий
  - Поиск и фильтрация

- **Авторизованные пользователи (User)**:
  - Все права гостей +
  - Создание статей
  - Редактирование своих статей
  - Удаление своих статей

- **Редакторы (Editor)**:
  - Все права пользователей +
  - Доступ к панели администратора
  - Управление всеми статьями
  - Управление категориями

- **Администраторы (Admin)**:
  - Все права редакторов +
  - Просмотр списка пользователей
  - Полный контроль над системой

## Основные особенности реализации

### Безопасность

- Пароли хешируются с помощью ASP.NET Core Identity
- CSRF защита на всех формах с помощью `[ValidateAntiForgeryToken]`
- Проверка прав доступа: только автор может редактировать/удалять свои статьи

### Валидация

- Валидация на стороне сервера с помощью DataAnnotations
- Валидация на стороне клиента с помощью jQuery Validation
- Кастомные сообщения об ошибках на русском языке

### Загрузка файлов

- Генерация уникальных имен файлов с помощью GUID
- Автоматическое создание директории uploads
- Удаление старых изображений при обновлении/удалении статьи
- Валидация типа файла (только изображения)

## Дальнейшие улучшения

Возможные направления для развития проекта:

- [ ] Пагинация списка статей
- [ ] Комментарии к статьям
- [ ] Система рейтингов
- [ ] Роли (администратор, модератор, пользователь)
- [ ] Расширенный поиск с фильтрами
- [ ] Теги для статей
- [ ] Экспорт статей в PDF
- [ ] API для мобильных приложений
- [ ] Уведомления по email
- [ ] Интеграция с внешними сервисами хранения (AWS S3, Azure Blob)

## Автор

Проект создан для демонстрации работы с ASP.NET Core MVC, Entity Framework Core и ASP.NET Identity.

## Лицензия

Свободное использование в образовательных целях.
